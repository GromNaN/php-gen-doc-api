<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="php-apidoc - apid documenation generator">
    <meta name="author" content="Calin Rada">
    <title>php-apidoc v {{ version }}</title>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        body      { padding-top: 70px; margin-bottom: 15px; }
        tbody th  { text-align: center; }
        a.anchor  { display: block; position: relative; top: -65px; visibility: hidden; }
        .tab-pane { padding-top: 10px; }
        .required { font-size: 11px; color: #666666;}
        .mt0      { margin-top: 0px; }
        .footer   { font-size: 12px; color: #666; }
        .label    { display: inline-block; min-width: 65px; padding: 0.3em 0.6em 0.3em; }
        .popover  { max-width: 400px; max-height: 400px; overflow-y: auto;}
    </style>
</head>
<body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">php-apidoc</a>
        </div>
        <div class="navbar-collapse collapse">
            <form class="navbar-form navbar-right">
                <div class="form-group">
                    Api key: <a href="javascript:void(0);" class="tooltipP" data-toggle="tooltip" title="Api key header with api key (key) and api key value (value) "><span class="glyphicon glyphicon-info-sign"></span></a>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="key" id="apikey_key">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="value" id="apikey_value">
                </div>
            </form>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h5>Api URL</h5>
                <input id="apiUrl" type="text" class="form-control input-sm" placeholder="http://api.mydomain.tld">
            </div>
        </div>
        <hr>
        <div class="panel-group" id="accordion">
            {{ content }}
        </div>
        <hr>

        <div class="row mt0 footer">
            <div class="col-md-6" align="left">
                Generated on {{ date }}
            </div>
            <div class="col-md-6" align="right">
                <a href="https://github.com/calinrada/php-apidoc" target="_blank">php-apidoc v {{ version }}</a>
            </div>
        </div>

    </div> <!-- /container -->

    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script src="https://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"></script>
    <script type="text/javascript">

    $(document).ready(function() {

        $('#php-apidoctab a').click(function(e) {
            e.preventDefault()
            $(this).tab('show')
        });

        $('.tooltipP').tooltip({
            placement: 'bottom'
        });

        $('code[id^=response]').hide();

        $.each($('pre[id^=sample_response]'), function() {
            if ($(this).html() == 'NA') {
                return;
            }
            var str = JSON.stringify(JSON.parse($(this).html().replace(/'/g, '"')), undefined, 4);
            $(this).html(str);
        });

        $("[data-toggle=popover]").popover({placement:'right'});

        $('body').on('shown.bs.popover', function() {
            var sample = $(this).find(".popover-content");
            if (sample.html() == 'NA') {
                return;
            }
            var str = JSON.stringify(JSON.parse(sample.html().replace(/'/g, '"')), undefined, 2);
            sample.html('<pre class="prettyprint">' + str + '</pre>');
            prettyPrint();
        });

        $('body').on('click', '.send', function(e) {
            e.preventDefault();
            var form = $(this).closest('form');
            var matchedParamsInRoute = $(form).attr('action').match(/{\w+}/g);
            var theId = $(this).attr('rel');

            var urlForm = $(form).attr('action');
            var dataSerialize = '';

            if (matchedParamsInRoute) {
                $("form#" + $(form).attr('id') + " input[type=text]").each(function() {
                    var input = $(this);
                    var index;
                    for (index = 0; index < matchedParamsInRoute.length; ++index) {
                        try {
                            var tmp = matchedParamsInRoute[index].replace('{', '').replace('}', '');
                            if ($(this).attr('id') == tmp) {
                                urlForm = urlForm.replace(matchedParamsInRoute[index], $(this).val());
                            }
                        } catch (err) {
                            console.log(err);
                        }
                    }
                });
            };

            $('#' + $(form).attr('id') + ' input[type=text]').each(function() {
                if (matchedParamsInRoute.indexOf('{'+$(this).attr('id')+'}') === -1 && $(this).val() !== '') {
                    dataSerialize += $(this).serialize() + '&';
                }
            });

            var st_headers = {};
            st_headers[$('#apikey_key').val()] = $('#apikey_value').val();
            $.ajax({
                url: $('#apiUrl').val() + urlForm,
                data : dataSerialize,
                type: '' + $(form).attr('method') + '',
                dataType: 'json',
                headers: st_headers,
                success: function (data, textStatus, jqXHR) {
                    if (typeof data === 'object') {
                        $('#response' + theId).html(JSON.stringify(data, undefined, 4)).removeClass("prettyprinted");
                        $('#response_body_' + theId + ' pre').html(JSON.stringify(data, undefined, 4)).removeClass("prettyprinted");
                        prettyPrint();
                    } else {
                        $('#response' + theId).html(data);
                        $('#response_body_' + theId + ' pre').html(data);
                    }
                },
                error: function (jqXHR, textStatus, error) {
                    if (typeof jqXHR.responseJSON === 'object') {
                        $('#response_body_' + theId + ' pre').html(JSON.stringify(jqXHR.responseJSON, undefined, 4)).removeClass("prettyprinted");
                        prettyPrint();
                    } else {
                        $('#response_body_' + theId + ' pre').html(jqXHR.responseText);
                    }
                },
                complete: function (jqXHR, textStatus) {
                    $('#request_url_' + theId + ' pre').html(location.protocol + '//' + location.host +this.url);
                    // $('#request_headers_' + theId + ' pre').html(this.headers);
                    // console.log(this.headers);
                    $('#response_code_' + theId + ' pre').html(jqXHR.status);
                    $('#response_headers_' + theId + ' pre').html(jqXHR.getAllResponseHeaders());
                    $('#response_' + theId).show();
                }
            });

            return false;
        });
    });
    </script>
</body>
</html>
